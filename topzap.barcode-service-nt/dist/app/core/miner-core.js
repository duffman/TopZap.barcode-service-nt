'use strict';Object.defineProperty(exports,'__esModule',{value:true});const phttp_client_1=require('../../lib/putte/inet/phttp-client');const logger_1=require('../cli/logger');const miner_data_models_1=require('./miner-data-models');const miner_request_1=require('./miner-request');const settings_1=require('../settings');const apiUri=settings_1.Settings.Endpoints.API_SERVER_URI;const minerApiUri=`${apiUri}/miner`;const minerSessionUri=`${minerApiUri}/session/`;const minerQueueUri=`${minerApiUri}/queue/`;const minerUpdateUri=`${minerApiUri}/update/`;class MinerCore{constructor(){this.session=null;this.req=new miner_request_1.MinerRequest();}getSession(vendorId){return new Promise((resolve,reject)=>{let reqUrl=minerSessionUri+vendorId;phttp_client_1.PHttpClient.getHttp(reqUrl).then(res=>{let model=miner_data_models_1.MinerDataConvert.toMinerSessionData(res);logger_1.Logger.logGreen('getSession :: success ::',res);resolve(model);}).catch(err=>{logger_1.Logger.logGreen('getSession :: error ::',err);reject(err);});});}getWorkQueueItems(sessionId,queueSize=10){return new Promise((resolve,reject)=>{let reqUrl=`${minerQueueUri}${sessionId}/${queueSize}`;phttp_client_1.PHttpClient.getHttp(reqUrl).then(res=>{let model=miner_data_models_1.MinerDataConvert.toMinerQueueData(res);resolve(model);}).catch(err=>{logger_1.Logger.logGreen('getWorkQueueItems :: error ::',err);reject(err);});});}updateWorkQueueItem(updateItem){let scope=this;return new Promise((resolve,reject)=>{scope.req.postRequest(minerUpdateUri,updateItem).then(res=>{logger_1.Logger.logGreen('updateWorkQueueItem :: success ::',res);resolve(true);}).catch(err=>{logger_1.Logger.logError('updateWorkQueueItem :: error ::',err);reject(err);});});}getVendorQueue(vendorId,queueSize=10){return new Promise((resolve,reject)=>{this.getSession(vendorId).then(res=>{logger_1.Logger.logGreen('execute :: success',res);this.session=res;this.getWorkQueueItems(res.id,queueSize).then(data=>{resolve(data);});}).catch(err=>{logger_1.Logger.logError('execute :: error ::',err);reject(err);});});}}exports.MinerCore=MinerCore;