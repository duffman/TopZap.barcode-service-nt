'use strict';Object.defineProperty(exports,'__esModule',{value:true});const request=require('request');const webuygames_data_1=require('./webuygames-data');class WbgAppWorker{constructor(){this.baseRequest=request.defaults({'url':'https://api.revivalbooks.co.uk','headers':{'User-Agent':'WeBuyGames/3.1.8 (com.revival.webuygames; build:1; iOS 10.1.1) Alamofire/4.0.1','Accept-Language':'en-UK','Accept-Encoding':'gzip;q=1.0, compress;q=0.5','Connection':'keep-alive'},'qs':{'key':'Y!VQpwYy4*nDp6m8dn7j','site':2},'gzip':true,'json':true});}async signin(basket){if(!basket){basket=await this.getBasket(undefined);}return new Promise((resolve,reject)=>{this.baseRequest.post({'qs':{'method':'Facebook'},'form':{'basketId':basket.data.id,'basketKey':basket.data.basketKey,'siteId':2,'forename':'John','surname':'Doe','email':Math.random().toString()}},function optionalCallback(err,httpResponse,body){if(err){reject(err);}else{let resultData;try{resultData=webuygames_data_1.Convert.toWeBuyGamesSignResult(body);resolve(resultData);}catch(err){resolve(null);}}});});}getBasket(sign){let basketId;let basketKey;let customerId;let customerKey;if(sign){basketId=sign.data.basketId;basketKey=sign.data.basketKey;customerId=sign.data.customerId;customerKey=sign.data.customerKey;}return new Promise((resolve,reject)=>{this.baseRequest.get({'qs':{'method':'Basket','basketId':basketId,'basketKey':basketKey,'customerId':customerId,'customerKey':customerKey}},function optionalCallback(err,httpResponse,body){if(err){reject(err);}else{let resultData;try{resultData=webuygames_data_1.Convert.toWeBuyGamesBasketResult(body);resolve(resultData);}catch(err){resolve(null);}}});});}async search(ean,sign){if(!sign){let basket=await this.getBasket(undefined);sign=await this.signin(basket);}return new Promise((resolve,reject)=>{this.baseRequest.post({'qs':{'method':'BasketAdd'},'form':{'basketId':sign.data.basketId,'basketKey':sign.data.basketKey,'customerId':sign.data.customerId,'customerKey':sign.data.customerKey,'site':2,'query':ean}},function optionalCallback(err,httpResponse,body){if(err){reject(err);}else{let resultData;try{resultData=webuygames_data_1.Convert.toWeBuyGamesResult(body);resolve(resultData);}catch(err){resolve(null);}}});});}removeFromBasket(itemId,sign){return new Promise((resolve,reject)=>{this.baseRequest.delete({'qs':{'method':'BasketItem','itemId':itemId,'basketId':sign.data.basketId,'basketKey':sign.data.basketKey,'customerId':sign.data.customerId,'customerKey':sign.data.customerKey}},function optionalCallback(err,httpResponse,body){if(err){reject(err);}else{let resultData;try{resultData=webuygames_data_1.Convert.toWeBuyGamesBasketResult(body);resolve(resultData);}catch(err){resolve(null);}}});});}}exports.WbgAppWorker=WbgAppWorker;